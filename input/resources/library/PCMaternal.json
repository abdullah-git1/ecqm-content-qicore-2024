{
  "resourceType": "Library",
  "id": "PCMaternal",
  "meta": {
    "profile": [ "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/computable-library-cqfm" ]
  },
  "language": "en",
  "text": {
    "status": "extensions",
    "div": "<div xmlns=\"http://www.w3.org/1999/xhtml\">\n    <table class=\"grid dict\">\n        \n            <tr>\n                <th scope=\"row\"><b>Id: </b></th>\n                <td style=\"padding-left: 4px;\">64b84d66774bb523d9a14578</td>\n            </tr>\n        \n        \n            <tr>\n                <th scope=\"row\"><b>Url: </b></th>\n                <td style=\"padding-left: 4px;\">http://ecqi.healthit.gov/ecqms/Library/PCMaternal</td>\n            </tr>\n        \n        \n            <tr>\n                <th scope=\"row\"><b>Version: </b></th>\n                <td style=\"padding-left: 4px;\">5.10.000</td>\n            </tr>\n        \n        \n            <tr>\n                <th scope=\"row\"><b>Identifier: </b></th>\n                <td style=\"padding-left: 4px;\">\n                    \n                    \n                        <p style=\"margin-bottom: 5px;\">\n                            <b>value: </b> <span>64b84d66774bb523d9a14578</span>\n                        </p>\n                    \n                </td>\n            </tr>\n        \n        \n            <tr>\n                <th scope=\"row\"><b>Name: </b></th>\n                <td style=\"padding-left: 4px;\">PCMaternal</td>\n            </tr>\n        \n        \n            <tr>\n                <th scope=\"row\"><b>Title: </b></th>\n                <td style=\"padding-left: 4px;\">PCMaternal</td>\n            </tr>\n        \n        \n        \n            <tr>\n                <th scope=\"row\"><b>Status: </b></th>\n                <td style=\"padding-left: 4px;\">active</td>\n            </tr>\n        \n        \n            <tr>\n                <th scope=\"row\"><b>Experimental: </b></th>\n                <td style=\"padding-left: 4px;\">false</td>\n            </tr>\n        \n        \n            <tr>\n                <th scope=\"row\"><b>Type: </b></th>\n                <td style=\"padding-left: 4px;\">\n                    \n                        \n                            \n                                <p style=\"margin-bottom: 5px;\">\n                                    <b>system: </b> <span>http://terminology.hl7.org/CodeSystem/library-type</span>\n                                </p>\n                            \n                            \n                                <p style=\"margin-bottom: 5px;\">\n                                    <b>code: </b> <span>logic-library</span>\n                                </p>\n                            \n                            \n                        \n                    \n                    \n                </td>\n            </tr>\n        \n        \n        \n            <tr>\n                <th scope=\"row\"><b>Date: </b></th>\n                <td style=\"padding-left: 4px;\">2023-08-21T20:21:27+00:00</td>\n            </tr>\n        \n        \n            <tr>\n                <th scope=\"row\"><b>Publisher: </b></th>\n                <td style=\"padding-left: 4px;\">The Joint Commission</td>\n            </tr>\n        \n        \n            <tr>\n                <th scope=\"row\"><b>Description: </b></th>\n                <td style=\"padding-left: 4px;\">This library specifies common data elements used by PC01, PC02, PC07.</td>\n            </tr>\n        \n        \n        \n        \n        \n        \n        \n        \n        \n        \n        \n        \n            <tr>\n                <th scope=\"row\"><b>Related Artifacts: </b></th>\n                <td style=\"padding-left: 4px;\">\n                    \n                    \n                    \n                        <p><b>Dependencies</b></p>\n                        <ul>\n                            \n                                <li/>\n                            \n                                <li/>\n                            \n                                <li/>\n                            \n                                <li/>\n                            \n                                <li/>\n                            \n                                <li/>\n                            \n                                <li/>\n                            \n                                <li/>\n                            \n                                <li/>\n                            \n                        </ul>\n                    \n                    \n                    \n                    \n                    \n                </td>\n            </tr>\n        \n        \n        \n            <tr>\n                <th scope=\"row\"><b>Data Requirements:</b></th>\n                <td style=\"padding-left: 4px;\">\n                    <table class=\"grid-dict\">\n                        <tr><th><b>Type</b></th><th><b>Profile</b></th><th><b>MS</b></th><th><b>Code Filter</b></th></tr>\n                        \n                            <tr>\n                                <th>Procedure</th>\n                                <th/>\n                                <th/>\n                                <th>\n                                    \n                                        <b>code filter: </b>\n                                        \n                                            <br/>\n                                        \n                                        \n                                            <span style=\"padding-left: 4px;\">\n                          <b>path: </b><span>code</span>\n                      </span>\n                                            \n                                                <br/>\n                                            \n                                        \n                                        \n                                            <span style=\"padding-left: 4px;\">\n                          <b>value set: </b><span>http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1045.59</span>\n                      </span>\n                                        \n                                        \n                                    \n                                </th>\n                            </tr>\n                        \n                            <tr>\n                                <th>Encounter</th>\n                                <th/>\n                                <th/>\n                                <th>\n                                    \n                                        <b>code filter: </b>\n                                        \n                                            <br/>\n                                        \n                                        \n                                            <span style=\"padding-left: 4px;\">\n                          <b>path: </b><span>code</span>\n                      </span>\n                                            \n                                                <br/>\n                                            \n                                        \n                                        \n                                            <span style=\"padding-left: 4px;\">\n                          <b>value set: </b><span>http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.3.666.5.307</span>\n                      </span>\n                                        \n                                        \n                                    \n                                </th>\n                            </tr>\n                        \n                            <tr>\n                                <th>Encounter</th>\n                                <th/>\n                                <th/>\n                                <th>\n                                    \n                                        <b>code filter: </b>\n                                        \n                                            <br/>\n                                        \n                                        \n                                            <span style=\"padding-left: 4px;\">\n                          <b>path: </b><span>code</span>\n                      </span>\n                                            \n                                                <br/>\n                                            \n                                        \n                                        \n                                            <span style=\"padding-left: 4px;\">\n                          <b>value set: </b><span>http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1111.143</span>\n                      </span>\n                                        \n                                        \n                                    \n                                </th>\n                            </tr>\n                        \n                            <tr>\n                                <th>Encounter</th>\n                                <th/>\n                                <th/>\n                                <th>\n                                    \n                                        <b>code filter: </b>\n                                        \n                                            <br/>\n                                        \n                                        \n                                            <span style=\"padding-left: 4px;\">\n                          <b>path: </b><span>code</span>\n                      </span>\n                                            \n                                                <br/>\n                                            \n                                        \n                                        \n                                            <span style=\"padding-left: 4px;\">\n                          <b>value set: </b><span>http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1029.369</span>\n                      </span>\n                                        \n                                        \n                                    \n                                </th>\n                            </tr>\n                        \n                            <tr>\n                                <th>Observation</th>\n                                <th/>\n                                <th/>\n                                <th>\n                                    \n                                        <b>code filter: </b>\n                                        \n                                            <br/>\n                                        \n                                        \n                                            <span style=\"padding-left: 4px;\">\n                          <b>path: </b><span>code</span>\n                      </span>\n                                            \n                                                <br/>\n                                            \n                                        \n                                        \n                                        \n                                            \n                                                <p style=\"margin-bottom: 5px;\">\n                                                    <b>system: </b> <span>http://loinc.org</span>\n                                                </p>\n                                            \n                                            \n                                                <p style=\"margin-bottom: 5px;\">\n                                                    <b>code: </b> <span>11778-8</span>\n                                                </p>\n                                            \n                                            \n                                                <p style=\"margin-bottom: 5px;\">\n                                                    <b>display: </b> <span>Delivery date Estimated</span>\n                                                </p>\n                                            \n                                        \n                                    \n                                </th>\n                            </tr>\n                        \n                            <tr>\n                                <th>Observation</th>\n                                <th/>\n                                <th/>\n                                <th>\n                                    \n                                        <b>code filter: </b>\n                                        \n                                            <br/>\n                                        \n                                        \n                                            <span style=\"padding-left: 4px;\">\n                          <b>path: </b><span>code</span>\n                      </span>\n                                            \n                                                <br/>\n                                            \n                                        \n                                        \n                                            <span style=\"padding-left: 4px;\">\n                          <b>value set: </b><span>http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1045.26</span>\n                      </span>\n                                        \n                                        \n                                    \n                                </th>\n                            </tr>\n                        \n                            <tr>\n                                <th>Observation</th>\n                                <th/>\n                                <th/>\n                                <th>\n                                    \n                                        <b>code filter: </b>\n                                        \n                                            <br/>\n                                        \n                                        \n                                            <span style=\"padding-left: 4px;\">\n                          <b>path: </b><span>code</span>\n                      </span>\n                                            \n                                                <br/>\n                                            \n                                        \n                                        \n                                        \n                                            \n                                                <p style=\"margin-bottom: 5px;\">\n                                                    <b>system: </b> <span>http://loinc.org</span>\n                                                </p>\n                                            \n                                            \n                                                <p style=\"margin-bottom: 5px;\">\n                                                    <b>code: </b> <span>93857-1</span>\n                                                </p>\n                                            \n                                            \n                                                <p style=\"margin-bottom: 5px;\">\n                                                    <b>display: </b> <span>Date and time of obstetric delivery</span>\n                                                </p>\n                                            \n                                        \n                                    \n                                </th>\n                            </tr>\n                        \n                    </table>\n                </td>\n            </tr>\n        \n        \n            \n                <tr>\n                    <td colspan=\"2\">\n                        <table>\n                            <tr><th><a id=\"cql-content\"><b>Content: </b></a> text/cql</th></tr>\n                            <tr><td><pre><code class=\"language-cql\">library PCMaternal version '5.10.000'\n\n/*@update: @@Created from QDM v2.1 to FHIR, then updated 041922 after annual update to QDM v2.21.000 @@*/\n\nusing QICore version '4.1.1'\n\ninclude FHIRHelpers version '4.3.000' called FHIRHelpers\ninclude CQMCommon version '1.4.000' called Global\ninclude QICoreCommon version '1.5.000' called QICoreCommon\n\ncodesystem &quot;LOINC&quot;: 'http://loinc.org' \n\nvalueset &quot;Delivery Procedures&quot;: 'http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1045.59' \nvalueset &quot;ED Visit and OB Triage&quot;: 'http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1029.369' \nvalueset &quot;Encounter Inpatient&quot;: 'http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.3.666.5.307' \nvalueset &quot;Estimated Gestational Age at Delivery&quot;: 'http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1045.26' \nvalueset &quot;Observation Services&quot;: 'http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1111.143' \n\ncode &quot;Date and time of obstetric delivery&quot;: '93857-1' from &quot;LOINC&quot; display 'Date and time of obstetric delivery'\ncode &quot;Delivery date Estimated&quot;: '11778-8' from &quot;LOINC&quot; display 'Delivery date Estimated'\n\nparameter &quot;Measurement Period&quot; Interval&lt;DateTime&gt;\n\ncontext Patient\n\ndefine &quot;Delivery Encounter with Age Range&quot;:\n  &quot;Encounter with Age Range&quot; EncounterWithAge\n                with [&quot;Procedure&quot;: &quot;Delivery Procedures&quot;] DeliveryProcedure\n                such that DeliveryProcedure.status = 'completed'\n                and DeliveryProcedure.performed.toInterval  ( ) starts during day of EncounterWithAge.hospitalizationWithEDOBTriageObservation ()\n\ndefine &quot;Encounter with Age Range&quot;:\n  [&quot;Encounter&quot;: &quot;Encounter Inpatient&quot;] EncounterInpatient\n                      where EncounterInpatient.status = 'finished'\n                        and AgeInYearsAt(date from start of EncounterInpatient.period) in Interval[ 8, 65 )\n                        and EncounterInpatient.period ends during day of &quot;Measurement Period&quot;\n\ndefine &quot;Variable Calculated Gestational Age&quot;:\n  //This definition establishes a variable of CGA (Calculated Gestational Age) for all patients for the sole purpose of displaying the Calculated Gestational Age. This definition is not used in the measure logic.\n  &quot;Delivery Encounter with Age Range&quot; QualifyingEncounter\n    let CGA: QualifyingEncounter.calculatedGestationalAge()\n  //  return { QualifyingEncounter, CGA }\n    return {\n      EncounterID: QualifyingEncounter.id,\n      CalculatedCGA: CGA\n    }\n\ndefine fluent function calculatedGestationalAge (TheEncounter Encounter ):\n  //Gestational Age = (280-(Estimated Delivery Date minus Reference Date/Delivery Date))/7\n  ( 280 - ( difference in days between TheEncounter.lastTimeOfDelivery () and TheEncounter.lastEstimatedDeliveryDate( )) ) div 7\n\n\n\n\n/*define function &quot;HospitalizationWithEDOBTriageObservation&quot;(Encounter Encounter ):\n  HospitalizationWithEDOBTriageObservation returns the total interval from the start of any immediately prior emergency department visit or OB Triage visit through the observation visit to the discharge of the given encounter\n  Encounter Visit\n    let ObsVisit: Last([&quot;Encounter&quot;: &quot;Observation Services&quot;] LastObs\n        where LastObs.period ends 1 hour or less on or before start of Visit.period\n          and LastObs.status = 'finished'\n        sort by \n        end of period\n    ),\n    VisitStart: Coalesce(start of ObsVisit.period, start of Visit.period),\n    EDOBTriageVisit: Last([&quot;Encounter&quot;: &quot;ED Visit and OB Triage&quot;] LastEDOBTriage\n        where LastEDOBTriage.period ends 1 hour or less on or before VisitStart\n          and LastEDOBTriage.status = 'finished'\n        sort by \n        end of period\n    )\n    return Interval[Coalesce(start of EDOBTriageVisit.period, VisitStart), \n    end of Visit.period]*/\n    \n    \ndefine fluent function hospitalizationWithEDOBTriageObservation (TheEncounter Encounter ):\n  /*hospitalizationWithEDOBTriageObservation returns the total interval from the start of any immediately prior emergency department visit or OB Triage visit through the observation visit to the discharge of the given encounter*/\n  TheEncounter Visit\n    let ObsVisit: Last([&quot;Encounter&quot;: &quot;Observation Services&quot;] LastObs\n        where LastObs.period ends 1 hour or less on or before start of Visit.period\n          and LastObs.status = 'finished'\n        sort by \n        end of period\n    ),\n    VisitStart: Coalesce(start of ObsVisit.period, start of Visit.period),\n    EDOBTriageVisit: Last([&quot;Encounter&quot;: &quot;ED Visit and OB Triage&quot;] LastEDOBTriage\n        where LastEDOBTriage.period ends 1 hour or less on or before VisitStart\n          and LastEDOBTriage.status = 'finished'\n        sort by \n        end of period\n    )\n    return Interval[Coalesce(start of EDOBTriageVisit.period, VisitStart), \n    end of Visit.period]\n  \n  /*===============================================================*/\n  /*  03/14/2022 from MATGlobalCommonFunctionsv7.000 - latest QDM  */\n  /*     even though this PCMaternalFHIR was derived from          */\n  /*     PCMaternal=2.1.000 cql, to make next update easier.       */\n  /*     Will need to re-insert &quot;Global&quot;. in front of these        */\n  /*     function names later (whereever they are directly used.*/\n\ndefine fluent function lastEstimatedDeliveryDate (TheEncounter Encounter ):\n  /*This function identifies the last time the EDD was assessed 42 weeks or less prior to or on delivery and stores the result of that assessment.*/\n  Last([&quot;Observation&quot;: &quot;Delivery date Estimated&quot;] EstimatedDateOfDelivery\n      where EstimatedDateOfDelivery.value as DateTime is not null\n        and EstimatedDateOfDelivery.status in { 'final', 'amended', 'corrected' }\n        and EstimatedDateOfDelivery.effective.earliest ( ) 42 weeks or less before or on TheEncounter.lastTimeOfDelivery ()\n      sort by effective.earliest ( )\n  ).value as DateTime\n\ndefine fluent function lastEstimatedGestationalAge (TheEncounter Encounter ):\n  Last([&quot;Observation&quot;: &quot;Estimated Gestational Age at Delivery&quot;] EstimatedGestationalAge\n      where EstimatedGestationalAge.value is not null\n        and EstimatedGestationalAge.status in { 'final', 'amended', 'corrected' }\n        and EstimatedGestationalAge.effective.earliest() 24 hours or less before or on TheEncounter.lastTimeOfDelivery ()\n      sort by effective.earliest ()\n  ).value as Quantity\n\ndefine fluent function lastTimeOfDelivery (TheEncounter Encounter ):\n  Last([&quot;Observation&quot;: &quot;Date and time of obstetric delivery&quot;] TimeOfDelivery\n      where TimeOfDelivery.value as DateTime is not null\n        and TimeOfDelivery.status in { 'final', 'amended', 'corrected' }\n        and TimeOfDelivery.effective.earliest () during TheEncounter.hospitalizationWithEDOBTriageObservation ()\n        and TimeOfDelivery.value as DateTime during TheEncounter.hospitalizationWithEDOBTriageObservation()\n      sort by effective.earliest()\n  ).value as DateTime</code></pre></td></tr>\n                        </table>\n                    </td>\n                </tr>\n            \n            \n        \n            \n            \n                <tr>\n                    <td colspan=\"2\">\n                        <table>\n                            <tr><th><b>Content: </b> application/elm+xml</th></tr>\n                            <tr><td><pre><code>Encoded data (266572 characters)</code></pre></td></tr>\n                        </table>\n                    </td>\n                </tr>\n            \n        \n            \n            \n                <tr>\n                    <td colspan=\"2\">\n                        <table>\n                            <tr><th><b>Content: </b> application/elm+json</th></tr>\n                            <tr><td><pre><code>Encoded data (393808 characters)</code></pre></td></tr>\n                        </table>\n                    </td>\n                </tr>\n            \n        \n    </table>\n</div>"
  },
  "extension": [ {
    "url": "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-softwaresystem",
    "valueReference": {
      "reference": "Device/cqf-tooling"
    }
  } ],
  "url": "http://ecqi.healthit.gov/ecqms/Library/PCMaternal",
  "identifier": [ {
    "use": "official",
    "system": "https://madie.cms.gov/login",
    "value": "64b84d66774bb523d9a14578"
  } ],
  "version": "5.10.000",
  "name": "PCMaternal",
  "title": "PCMaternal",
  "status": "active",
  "experimental": false,
  "type": {
    "coding": [ {
      "system": "http://terminology.hl7.org/CodeSystem/library-type",
      "code": "logic-library"
    } ]
  },
  "date": "2023-08-21T20:21:27+00:00",
  "publisher": "The Joint Commission",
  "description": "This library specifies common data elements used by PC01, PC02, PC07.",
  "relatedArtifact": [ {
    "id": "93857-1",
    "display": "Date and time of obstetric delivery",
    "url": "http://loinc.org",
    "document": {
      "url": "http://loinc.org"
    }
  }, {
    "id": "11778-8",
    "display": "Delivery date Estimated",
    "url": "http://loinc.org",
    "document": {
      "url": "http://loinc.org"
    }
  } ],
  "content": [ {
    "contentType": "text/cql",
    "data": "bGlicmFyeSBQQ01hdGVybmFsIHZlcnNpb24gJzUuMTAuMDAwJwoKLypAdXBkYXRlOiBAQENyZWF0ZWQgZnJvbSBRRE0gdjIuMSB0byBGSElSLCB0aGVuIHVwZGF0ZWQgMDQxOTIyIGFmdGVyIGFubnVhbCB1cGRhdGUgdG8gUURNIHYyLjIxLjAwMCBAQCovCgp1c2luZyBRSUNvcmUgdmVyc2lvbiAnNC4xLjEnCgppbmNsdWRlIEZISVJIZWxwZXJzIHZlcnNpb24gJzQuMy4wMDAnIGNhbGxlZCBGSElSSGVscGVycwppbmNsdWRlIENRTUNvbW1vbiB2ZXJzaW9uICcxLjQuMDAwJyBjYWxsZWQgR2xvYmFsCmluY2x1ZGUgUUlDb3JlQ29tbW9uIHZlcnNpb24gJzEuNS4wMDAnIGNhbGxlZCBRSUNvcmVDb21tb24KCmNvZGVzeXN0ZW0gIkxPSU5DIjogJ2h0dHA6Ly9sb2luYy5vcmcnIAoKdmFsdWVzZXQgIkRlbGl2ZXJ5IFByb2NlZHVyZXMiOiAnaHR0cDovL2N0cy5ubG0ubmloLmdvdi9maGlyL1ZhbHVlU2V0LzIuMTYuODQwLjEuMTEzNzYyLjEuNC4xMDQ1LjU5JyAKdmFsdWVzZXQgIkVEIFZpc2l0IGFuZCBPQiBUcmlhZ2UiOiAnaHR0cDovL2N0cy5ubG0ubmloLmdvdi9maGlyL1ZhbHVlU2V0LzIuMTYuODQwLjEuMTEzNzYyLjEuNC4xMDI5LjM2OScgCnZhbHVlc2V0ICJFbmNvdW50ZXIgSW5wYXRpZW50IjogJ2h0dHA6Ly9jdHMubmxtLm5paC5nb3YvZmhpci9WYWx1ZVNldC8yLjE2Ljg0MC4xLjExMzg4My4zLjY2Ni41LjMwNycgCnZhbHVlc2V0ICJFc3RpbWF0ZWQgR2VzdGF0aW9uYWwgQWdlIGF0IERlbGl2ZXJ5IjogJ2h0dHA6Ly9jdHMubmxtLm5paC5nb3YvZmhpci9WYWx1ZVNldC8yLjE2Ljg0MC4xLjExMzc2Mi4xLjQuMTA0NS4yNicgCnZhbHVlc2V0ICJPYnNlcnZhdGlvbiBTZXJ2aWNlcyI6ICdodHRwOi8vY3RzLm5sbS5uaWguZ292L2ZoaXIvVmFsdWVTZXQvMi4xNi44NDAuMS4xMTM3NjIuMS40LjExMTEuMTQzJyAKCmNvZGUgIkRhdGUgYW5kIHRpbWUgb2Ygb2JzdGV0cmljIGRlbGl2ZXJ5IjogJzkzODU3LTEnIGZyb20gIkxPSU5DIiBkaXNwbGF5ICdEYXRlIGFuZCB0aW1lIG9mIG9ic3RldHJpYyBkZWxpdmVyeScKY29kZSAiRGVsaXZlcnkgZGF0ZSBFc3RpbWF0ZWQiOiAnMTE3NzgtOCcgZnJvbSAiTE9JTkMiIGRpc3BsYXkgJ0RlbGl2ZXJ5IGRhdGUgRXN0aW1hdGVkJwoKcGFyYW1ldGVyICJNZWFzdXJlbWVudCBQZXJpb2QiIEludGVydmFsPERhdGVUaW1lPgoKY29udGV4dCBQYXRpZW50CgpkZWZpbmUgIkRlbGl2ZXJ5IEVuY291bnRlciB3aXRoIEFnZSBSYW5nZSI6CiAgIkVuY291bnRlciB3aXRoIEFnZSBSYW5nZSIgRW5jb3VudGVyV2l0aEFnZQogICAgICAgICAgICAgICAgd2l0aCBbIlByb2NlZHVyZSI6ICJEZWxpdmVyeSBQcm9jZWR1cmVzIl0gRGVsaXZlcnlQcm9jZWR1cmUKICAgICAgICAgICAgICAgIHN1Y2ggdGhhdCBEZWxpdmVyeVByb2NlZHVyZS5zdGF0dXMgPSAnY29tcGxldGVkJwogICAgICAgICAgICAgICAgYW5kIERlbGl2ZXJ5UHJvY2VkdXJlLnBlcmZvcm1lZC50b0ludGVydmFsICAoICkgc3RhcnRzIGR1cmluZyBkYXkgb2YgRW5jb3VudGVyV2l0aEFnZS5ob3NwaXRhbGl6YXRpb25XaXRoRURPQlRyaWFnZU9ic2VydmF0aW9uICgpCgpkZWZpbmUgIkVuY291bnRlciB3aXRoIEFnZSBSYW5nZSI6CiAgWyJFbmNvdW50ZXIiOiAiRW5jb3VudGVyIElucGF0aWVudCJdIEVuY291bnRlcklucGF0aWVudAogICAgICAgICAgICAgICAgICAgICAgd2hlcmUgRW5jb3VudGVySW5wYXRpZW50LnN0YXR1cyA9ICdmaW5pc2hlZCcKICAgICAgICAgICAgICAgICAgICAgICAgYW5kIEFnZUluWWVhcnNBdChkYXRlIGZyb20gc3RhcnQgb2YgRW5jb3VudGVySW5wYXRpZW50LnBlcmlvZCkgaW4gSW50ZXJ2YWxbIDgsIDY1ICkKICAgICAgICAgICAgICAgICAgICAgICAgYW5kIEVuY291bnRlcklucGF0aWVudC5wZXJpb2QgZW5kcyBkdXJpbmcgZGF5IG9mICJNZWFzdXJlbWVudCBQZXJpb2QiCgpkZWZpbmUgIlZhcmlhYmxlIENhbGN1bGF0ZWQgR2VzdGF0aW9uYWwgQWdlIjoKICAvL1RoaXMgZGVmaW5pdGlvbiBlc3RhYmxpc2hlcyBhIHZhcmlhYmxlIG9mIENHQSAoQ2FsY3VsYXRlZCBHZXN0YXRpb25hbCBBZ2UpIGZvciBhbGwgcGF0aWVudHMgZm9yIHRoZSBzb2xlIHB1cnBvc2Ugb2YgZGlzcGxheWluZyB0aGUgQ2FsY3VsYXRlZCBHZXN0YXRpb25hbCBBZ2UuIFRoaXMgZGVmaW5pdGlvbiBpcyBub3QgdXNlZCBpbiB0aGUgbWVhc3VyZSBsb2dpYy4KICAiRGVsaXZlcnkgRW5jb3VudGVyIHdpdGggQWdlIFJhbmdlIiBRdWFsaWZ5aW5nRW5jb3VudGVyCiAgICBsZXQgQ0dBOiBRdWFsaWZ5aW5nRW5jb3VudGVyLmNhbGN1bGF0ZWRHZXN0YXRpb25hbEFnZSgpCiAgLy8gIHJldHVybiB7IFF1YWxpZnlpbmdFbmNvdW50ZXIsIENHQSB9CiAgICByZXR1cm4gewogICAgICBFbmNvdW50ZXJJRDogUXVhbGlmeWluZ0VuY291bnRlci5pZCwKICAgICAgQ2FsY3VsYXRlZENHQTogQ0dBCiAgICB9CgpkZWZpbmUgZmx1ZW50IGZ1bmN0aW9uIGNhbGN1bGF0ZWRHZXN0YXRpb25hbEFnZSAoVGhlRW5jb3VudGVyIEVuY291bnRlciApOgogIC8vR2VzdGF0aW9uYWwgQWdlID0gKDI4MC0oRXN0aW1hdGVkIERlbGl2ZXJ5IERhdGUgbWludXMgUmVmZXJlbmNlIERhdGUvRGVsaXZlcnkgRGF0ZSkpLzcKICAoIDI4MCAtICggZGlmZmVyZW5jZSBpbiBkYXlzIGJldHdlZW4gVGhlRW5jb3VudGVyLmxhc3RUaW1lT2ZEZWxpdmVyeSAoKSBhbmQgVGhlRW5jb3VudGVyLmxhc3RFc3RpbWF0ZWREZWxpdmVyeURhdGUoICkpICkgZGl2IDcKCgoKCi8qZGVmaW5lIGZ1bmN0aW9uICJIb3NwaXRhbGl6YXRpb25XaXRoRURPQlRyaWFnZU9ic2VydmF0aW9uIihFbmNvdW50ZXIgRW5jb3VudGVyICk6CiAgSG9zcGl0YWxpemF0aW9uV2l0aEVET0JUcmlhZ2VPYnNlcnZhdGlvbiByZXR1cm5zIHRoZSB0b3RhbCBpbnRlcnZhbCBmcm9tIHRoZSBzdGFydCBvZiBhbnkgaW1tZWRpYXRlbHkgcHJpb3IgZW1lcmdlbmN5IGRlcGFydG1lbnQgdmlzaXQgb3IgT0IgVHJpYWdlIHZpc2l0IHRocm91Z2ggdGhlIG9ic2VydmF0aW9uIHZpc2l0IHRvIHRoZSBkaXNjaGFyZ2Ugb2YgdGhlIGdpdmVuIGVuY291bnRlcgogIEVuY291bnRlciBWaXNpdAogICAgbGV0IE9ic1Zpc2l0OiBMYXN0KFsiRW5jb3VudGVyIjogIk9ic2VydmF0aW9uIFNlcnZpY2VzIl0gTGFzdE9icwogICAgICAgIHdoZXJlIExhc3RPYnMucGVyaW9kIGVuZHMgMSBob3VyIG9yIGxlc3Mgb24gb3IgYmVmb3JlIHN0YXJ0IG9mIFZpc2l0LnBlcmlvZAogICAgICAgICAgYW5kIExhc3RPYnMuc3RhdHVzID0gJ2ZpbmlzaGVkJwogICAgICAgIHNvcnQgYnkgCiAgICAgICAgZW5kIG9mIHBlcmlvZAogICAgKSwKICAgIFZpc2l0U3RhcnQ6IENvYWxlc2NlKHN0YXJ0IG9mIE9ic1Zpc2l0LnBlcmlvZCwgc3RhcnQgb2YgVmlzaXQucGVyaW9kKSwKICAgIEVET0JUcmlhZ2VWaXNpdDogTGFzdChbIkVuY291bnRlciI6ICJFRCBWaXNpdCBhbmQgT0IgVHJpYWdlIl0gTGFzdEVET0JUcmlhZ2UKICAgICAgICB3aGVyZSBMYXN0RURPQlRyaWFnZS5wZXJpb2QgZW5kcyAxIGhvdXIgb3IgbGVzcyBvbiBvciBiZWZvcmUgVmlzaXRTdGFydAogICAgICAgICAgYW5kIExhc3RFRE9CVHJpYWdlLnN0YXR1cyA9ICdmaW5pc2hlZCcKICAgICAgICBzb3J0IGJ5IAogICAgICAgIGVuZCBvZiBwZXJpb2QKICAgICkKICAgIHJldHVybiBJbnRlcnZhbFtDb2FsZXNjZShzdGFydCBvZiBFRE9CVHJpYWdlVmlzaXQucGVyaW9kLCBWaXNpdFN0YXJ0KSwgCiAgICBlbmQgb2YgVmlzaXQucGVyaW9kXSovCiAgICAKICAgIApkZWZpbmUgZmx1ZW50IGZ1bmN0aW9uIGhvc3BpdGFsaXphdGlvbldpdGhFRE9CVHJpYWdlT2JzZXJ2YXRpb24gKFRoZUVuY291bnRlciBFbmNvdW50ZXIgKToKICAvKmhvc3BpdGFsaXphdGlvbldpdGhFRE9CVHJpYWdlT2JzZXJ2YXRpb24gcmV0dXJucyB0aGUgdG90YWwgaW50ZXJ2YWwgZnJvbSB0aGUgc3RhcnQgb2YgYW55IGltbWVkaWF0ZWx5IHByaW9yIGVtZXJnZW5jeSBkZXBhcnRtZW50IHZpc2l0IG9yIE9CIFRyaWFnZSB2aXNpdCB0aHJvdWdoIHRoZSBvYnNlcnZhdGlvbiB2aXNpdCB0byB0aGUgZGlzY2hhcmdlIG9mIHRoZSBnaXZlbiBlbmNvdW50ZXIqLwogIFRoZUVuY291bnRlciBWaXNpdAogICAgbGV0IE9ic1Zpc2l0OiBMYXN0KFsiRW5jb3VudGVyIjogIk9ic2VydmF0aW9uIFNlcnZpY2VzIl0gTGFzdE9icwogICAgICAgIHdoZXJlIExhc3RPYnMucGVyaW9kIGVuZHMgMSBob3VyIG9yIGxlc3Mgb24gb3IgYmVmb3JlIHN0YXJ0IG9mIFZpc2l0LnBlcmlvZAogICAgICAgICAgYW5kIExhc3RPYnMuc3RhdHVzID0gJ2ZpbmlzaGVkJwogICAgICAgIHNvcnQgYnkgCiAgICAgICAgZW5kIG9mIHBlcmlvZAogICAgKSwKICAgIFZpc2l0U3RhcnQ6IENvYWxlc2NlKHN0YXJ0IG9mIE9ic1Zpc2l0LnBlcmlvZCwgc3RhcnQgb2YgVmlzaXQucGVyaW9kKSwKICAgIEVET0JUcmlhZ2VWaXNpdDogTGFzdChbIkVuY291bnRlciI6ICJFRCBWaXNpdCBhbmQgT0IgVHJpYWdlIl0gTGFzdEVET0JUcmlhZ2UKICAgICAgICB3aGVyZSBMYXN0RURPQlRyaWFnZS5wZXJpb2QgZW5kcyAxIGhvdXIgb3IgbGVzcyBvbiBvciBiZWZvcmUgVmlzaXRTdGFydAogICAgICAgICAgYW5kIExhc3RFRE9CVHJpYWdlLnN0YXR1cyA9ICdmaW5pc2hlZCcKICAgICAgICBzb3J0IGJ5IAogICAgICAgIGVuZCBvZiBwZXJpb2QKICAgICkKICAgIHJldHVybiBJbnRlcnZhbFtDb2FsZXNjZShzdGFydCBvZiBFRE9CVHJpYWdlVmlzaXQucGVyaW9kLCBWaXNpdFN0YXJ0KSwgCiAgICBlbmQgb2YgVmlzaXQucGVyaW9kXQogIAogIC8qPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8KICAvKiAgMDMvMTQvMjAyMiBmcm9tIE1BVEdsb2JhbENvbW1vbkZ1bmN0aW9uc3Y3LjAwMCAtIGxhdGVzdCBRRE0gICovCiAgLyogICAgIGV2ZW4gdGhvdWdoIHRoaXMgUENNYXRlcm5hbEZISVIgd2FzIGRlcml2ZWQgZnJvbSAgICAgICAgICAqLwogIC8qICAgICBQQ01hdGVybmFsPTIuMS4wMDAgY3FsLCB0byBtYWtlIG5leHQgdXBkYXRlIGVhc2llci4gICAgICAgKi8KICAvKiAgICAgV2lsbCBuZWVkIHRvIHJlLWluc2VydCAiR2xvYmFsIi4gaW4gZnJvbnQgb2YgdGhlc2UgICAgICAgICovCiAgLyogICAgIGZ1bmN0aW9uIG5hbWVzIGxhdGVyICh3aGVyZWV2ZXIgdGhleSBhcmUgZGlyZWN0bHkgdXNlZC4qLwoKZGVmaW5lIGZsdWVudCBmdW5jdGlvbiBsYXN0RXN0aW1hdGVkRGVsaXZlcnlEYXRlIChUaGVFbmNvdW50ZXIgRW5jb3VudGVyICk6CiAgLypUaGlzIGZ1bmN0aW9uIGlkZW50aWZpZXMgdGhlIGxhc3QgdGltZSB0aGUgRUREIHdhcyBhc3Nlc3NlZCA0MiB3ZWVrcyBvciBsZXNzIHByaW9yIHRvIG9yIG9uIGRlbGl2ZXJ5IGFuZCBzdG9yZXMgdGhlIHJlc3VsdCBvZiB0aGF0IGFzc2Vzc21lbnQuKi8KICBMYXN0KFsiT2JzZXJ2YXRpb24iOiAiRGVsaXZlcnkgZGF0ZSBFc3RpbWF0ZWQiXSBFc3RpbWF0ZWREYXRlT2ZEZWxpdmVyeQogICAgICB3aGVyZSBFc3RpbWF0ZWREYXRlT2ZEZWxpdmVyeS52YWx1ZSBhcyBEYXRlVGltZSBpcyBub3QgbnVsbAogICAgICAgIGFuZCBFc3RpbWF0ZWREYXRlT2ZEZWxpdmVyeS5zdGF0dXMgaW4geyAnZmluYWwnLCAnYW1lbmRlZCcsICdjb3JyZWN0ZWQnIH0KICAgICAgICBhbmQgRXN0aW1hdGVkRGF0ZU9mRGVsaXZlcnkuZWZmZWN0aXZlLmVhcmxpZXN0ICggKSA0MiB3ZWVrcyBvciBsZXNzIGJlZm9yZSBvciBvbiBUaGVFbmNvdW50ZXIubGFzdFRpbWVPZkRlbGl2ZXJ5ICgpCiAgICAgIHNvcnQgYnkgZWZmZWN0aXZlLmVhcmxpZXN0ICggKQogICkudmFsdWUgYXMgRGF0ZVRpbWUKCmRlZmluZSBmbHVlbnQgZnVuY3Rpb24gbGFzdEVzdGltYXRlZEdlc3RhdGlvbmFsQWdlIChUaGVFbmNvdW50ZXIgRW5jb3VudGVyICk6CiAgTGFzdChbIk9ic2VydmF0aW9uIjogIkVzdGltYXRlZCBHZXN0YXRpb25hbCBBZ2UgYXQgRGVsaXZlcnkiXSBFc3RpbWF0ZWRHZXN0YXRpb25hbEFnZQogICAgICB3aGVyZSBFc3RpbWF0ZWRHZXN0YXRpb25hbEFnZS52YWx1ZSBpcyBub3QgbnVsbAogICAgICAgIGFuZCBFc3RpbWF0ZWRHZXN0YXRpb25hbEFnZS5zdGF0dXMgaW4geyAnZmluYWwnLCAnYW1lbmRlZCcsICdjb3JyZWN0ZWQnIH0KICAgICAgICBhbmQgRXN0aW1hdGVkR2VzdGF0aW9uYWxBZ2UuZWZmZWN0aXZlLmVhcmxpZXN0KCkgMjQgaG91cnMgb3IgbGVzcyBiZWZvcmUgb3Igb24gVGhlRW5jb3VudGVyLmxhc3RUaW1lT2ZEZWxpdmVyeSAoKQogICAgICBzb3J0IGJ5IGVmZmVjdGl2ZS5lYXJsaWVzdCAoKQogICkudmFsdWUgYXMgUXVhbnRpdHkKCmRlZmluZSBmbHVlbnQgZnVuY3Rpb24gbGFzdFRpbWVPZkRlbGl2ZXJ5IChUaGVFbmNvdW50ZXIgRW5jb3VudGVyICk6CiAgTGFzdChbIk9ic2VydmF0aW9uIjogIkRhdGUgYW5kIHRpbWUgb2Ygb2JzdGV0cmljIGRlbGl2ZXJ5Il0gVGltZU9mRGVsaXZlcnkKICAgICAgd2hlcmUgVGltZU9mRGVsaXZlcnkudmFsdWUgYXMgRGF0ZVRpbWUgaXMgbm90IG51bGwKICAgICAgICBhbmQgVGltZU9mRGVsaXZlcnkuc3RhdHVzIGluIHsgJ2ZpbmFsJywgJ2FtZW5kZWQnLCAnY29ycmVjdGVkJyB9CiAgICAgICAgYW5kIFRpbWVPZkRlbGl2ZXJ5LmVmZmVjdGl2ZS5lYXJsaWVzdCAoKSBkdXJpbmcgVGhlRW5jb3VudGVyLmhvc3BpdGFsaXphdGlvbldpdGhFRE9CVHJpYWdlT2JzZXJ2YXRpb24gKCkKICAgICAgICBhbmQgVGltZU9mRGVsaXZlcnkudmFsdWUgYXMgRGF0ZVRpbWUgZHVyaW5nIFRoZUVuY291bnRlci5ob3NwaXRhbGl6YXRpb25XaXRoRURPQlRyaWFnZU9ic2VydmF0aW9uKCkKICAgICAgc29ydCBieSBlZmZlY3RpdmUuZWFybGllc3QoKQogICkudmFsdWUgYXMgRGF0ZVRpbWU="
  } ]
}